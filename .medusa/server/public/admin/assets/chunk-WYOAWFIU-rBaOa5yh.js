import{C as w}from"./chunk-AHQI2S2Z-D9P6VzXR.js";import{u as F}from"./chunk-HFB3OQXI-BU0fG9iQ.js";import{C as B}from"./chunk-OFN7DIZA-CaIWND1H.js";import{K as S}from"./chunk-6HTZNHPT-CuoURaae.js";import{u as A,b as h}from"./chunk-AERWK3TJ-Bn16cSY6.js";import{aq as E,as as V,ar as K,b,ax as T,ay as D,e7 as I,t as N,Q as y,r as C,j as e,B as v,K as L,s as P,e8 as R,X as c,H as _,_ as t}from"./index-8g9qLHfJ.js";import{R as j}from"./radio-group-DWgDxSql.js";var z={spend:"spend",usage:"usage",use_by_attribute:"useByAttribute"},M=s=>{const i=z[s==null?void 0:s.type]||"-";return(s==null?void 0:s.type)==="use_by_attribute"?(s==null?void 0:s.attribute)==="customer_id"?"campaigns.budget.type.useByAttribute.titleCustomerId":(s==null?void 0:s.attribute)==="customer_email"?"campaigns.budget.type.useByAttribute.titleEmail":"campaigns.budget.type.useByAttribute.title":`campaigns.budget.type.${i}.title`},q=({campaign:s})=>{var d,a,m,l,o,x;const{t:i}=b();if(s)return e.jsxs(C.Fragment,{children:[e.jsxs("div",{children:[e.jsx(_,{level:"h2",className:"mb-4",children:i("campaigns.details")}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center py-1",children:[e.jsx(t,{className:"txt-small-plus font-",children:i("campaigns.fields.identifier")}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(t,{className:"txt-small",children:s.campaign_identifier||"-"})})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center py-1",children:[e.jsx(t,{className:"txt-small-plus",children:i("fields.description")}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(t,{className:"txt-small",children:s.description||"-"})})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center py-1",children:[e.jsx(t,{className:"txt-small-plus",children:i("campaigns.fields.start_date")}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(t,{className:"txt-small",children:((d=s.starts_at)==null?void 0:d.toString())||"-"})})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center py-1",children:[e.jsx(t,{className:"txt-small-plus",children:i("campaigns.fields.end_date")}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(t,{className:"txt-small",children:((a=s.ends_at)==null?void 0:a.toString())||"-"})})]})]}),e.jsxs("div",{children:[e.jsx(_,{level:"h2",className:"mb-4",children:i("campaigns.budget.details")}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center py-1",children:[e.jsx(t,{className:"txt-small-plus font-",children:i("campaigns.budget.fields.type")}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(t,{className:"txt-small truncate",children:i(M(s.budget),{defaultValue:"-"})})})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center py-1",children:[e.jsx(t,{className:"txt-small-plus",children:i("campaigns.budget.fields.currency")}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(t,{className:"txt-small",children:((m=s==null?void 0:s.budget)==null?void 0:m.currency_code)||"-"})})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center py-1",children:[e.jsx(t,{className:"txt-small-plus",children:i("campaigns.budget.fields.limit")}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(t,{className:"txt-small",children:((l=s.budget)==null?void 0:l.limit)||"-"})})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center py-1",children:[e.jsx(t,{className:"txt-small-plus",children:((o=s.budget)==null?void 0:o.type)==="use_by_attribute"?i("campaigns.fields.totalUsedByAttribute"):i("campaigns.budget.fields.used")}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(t,{className:"txt-small",children:((x=s.budget)==null?void 0:x.used)||"-"})})]})]})]})},U=E({campaign_id:V().optional().nullable(),campaign_choice:K(["none","existing"]).optional()}),H=({form:s,withNewCampaign:i=!0,promotionCurrencyCode:d})=>{const{t:a}=b(),m=L(),l=y({control:s.control,name:"campaign_id"}),o=y({control:s.control,name:"campaign_choice"}),x=F({queryFn:n=>P.admin.campaign.list({...n}),queryKey:["campaigns"],getOptions:n=>n.campaigns.map(r=>{var p,u,g;return{label:r.name.toUpperCase(),value:r.id,disabled:((p=r.budget)==null?void 0:p.currency_code)&&((g=(u=r.budget)==null?void 0:u.currency_code)==null?void 0:g.toLowerCase())!==(d==null?void 0:d.toLowerCase())}})}),{campaign:f}=R(l,void 0,{enabled:!!l});return e.jsxs("div",{className:"flex flex-col gap-y-8",children:[e.jsx(c.Field,{control:s.control,name:"campaign_choice",render:({field:n})=>e.jsxs(c.Item,{children:[e.jsx(c.Label,{children:a("promotions.fields.campaign")}),e.jsx(c.Control,{children:e.jsxs(j,{dir:m,className:"grid grid-cols-1 gap-3",...n,value:n.value,onValueChange:n.onChange,children:[e.jsx(j.ChoiceBox,{value:"none",label:a("promotions.form.campaign.none.title"),description:a("promotions.form.campaign.none.description")}),e.jsx(j.ChoiceBox,{value:"existing",label:a("promotions.form.campaign.existing.title"),description:a("promotions.form.campaign.existing.description")}),i&&e.jsx(j.ChoiceBox,{value:"new",label:a("promotions.form.campaign.new.title"),description:a("promotions.form.campaign.new.description")})]})}),e.jsx(c.ErrorMessage,{})]})}),o==="existing"&&e.jsx(c.Field,{control:s.control,name:"campaign_id",render:({field:{onChange:n,...r}})=>e.jsxs(c.Item,{children:[e.jsx(c.Label,{tooltip:a("campaigns.fields.campaign_id.hint"),children:a("promotions.form.campaign.existing.title")}),e.jsx(c.Control,{children:e.jsx(B,{dir:m,options:x.options,searchValue:x.searchValue,onSearchValueChange:x.onSearchValueChange,onChange:n,...r})}),e.jsx(c.ErrorMessage,{})]})}),o==="new"&&e.jsx(w,{form:s,fieldScope:"campaign."}),e.jsx(q,{campaign:f})]})},J=({promotion:s})=>{var p;const{t:i}=b(),{handleSuccess:d}=A(),{campaign:a}=s,m=a==null?void 0:a.id,l=T({defaultValues:{campaign_id:a==null?void 0:a.id,campaign_choice:a!=null&&a.id?"existing":"none"},resolver:D(U)}),{setValue:o}=l,{mutateAsync:x,isPending:f}=I(s.id),n=l.handleSubmit(async u=>{await x({campaign_id:u.campaign_id},{onSuccess:()=>{N.success(i("promotions.campaign.edit.successToast")),d()},onError:g=>{N.error(g.message)}})}),r=y({control:l.control,name:"campaign_choice"});return C.useEffect(()=>{r==="none"&&o("campaign_id",null),r==="existing"&&o("campaign_id",m)},[r,o,m]),e.jsx(h.Form,{form:l,children:e.jsxs(S,{onSubmit:n,className:"flex size-full flex-col overflow-hidden",children:[e.jsx(h.Body,{className:"size-full overflow-auto",children:e.jsx(H,{form:l,withNewCampaign:!1,promotionCurrencyCode:(p=s.application_method)==null?void 0:p.currency_code})}),e.jsx(h.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(h.Close,{asChild:!0,children:e.jsx(v,{size:"small",variant:"secondary",children:i("actions.cancel")})}),e.jsx(v,{size:"small",type:"submit",isLoading:f,children:i("actions.save")})]})})]})})};export{H as A,J as a};
