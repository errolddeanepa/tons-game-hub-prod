import{t as oe}from"./chunk-6CPMXY5N-BnsD9cSz.js";import{D as le,T as ue}from"./chunk-3I6G3NRU-BQS64Frg.js";import{D as ce}from"./chunk-SJ3E4T6B-yyp3ORa1.js";import{M as de}from"./chunk-INE2QCSC-DX0LTFyC.js";import{P as fe,S as ge,C as me,V as _e}from"./chunk-XLDQPLK4-DxWsoRDg.js";import{P as he}from"./chunk-IQBAUTU5-DifaujUc.js";import{D as ye,S as pe,u as be,a as Ce}from"./chunk-7GBCLBMX-C4oTIfDM.js";import{u as Se}from"./chunk-C76H5USB-CpZUC32H.js";import{j as c,ae as ve,aj as G,bB as je,ag as xe,b as W,r as p,B as X,C as De,g as Ae,bC as $,bD as Oe,d as Ne,ao as Ee,bE as Re,a6 as Te}from"./index-8g9qLHfJ.js";import{R as we}from"./react-country-flag.esm-BCkCpgF1.js";var Fe=({isDefaultView:e,currentViewId:t,currentViewName:r,onSaveAsDefault:n,onUpdateExisting:s,onSaveAsNew:i})=>{const{t:a}=W(),f=Ae(),u=async()=>{await f({title:a("views.prompts.updateDefault.title"),description:a("views.prompts.updateDefault.description"),confirmText:a("views.prompts.updateDefault.confirmText"),cancelText:a("views.prompts.updateDefault.cancelText")})&&n()},C=async()=>{await f({title:a("views.prompts.updateView.title"),description:a("views.prompts.updateView.description",{name:r}),confirmText:a("views.prompts.updateView.confirmText"),cancelText:a("views.prompts.updateView.cancelText")})&&s()};return c.jsxs($,{children:[c.jsx($.Trigger,{asChild:!0,children:c.jsxs(X,{variant:"secondary",size:"small",type:"button",children:[a("views.save"),c.jsx(Oe,{})]})}),c.jsx($.Content,{align:"end",children:e?c.jsxs(c.Fragment,{children:[c.jsx($.Item,{onClick:u,children:a("views.updateDefaultForEveryone")}),c.jsx($.Item,{onClick:i,children:a("views.saveAsNew")})]}):c.jsxs(c.Fragment,{children:[c.jsx($.Item,{onClick:C,children:a("views.updateViewName")}),c.jsx($.Item,{onClick:i,children:a("views.saveAsNew")})]})})]})};function $e(e,t){const[r,n]=p.useState(()=>{if(e!=null&&e.length&&(t!=null&&t.configuration)){const o={};return e.forEach(l=>{var g;o[l.field]=((g=t.configuration.visible_columns)==null?void 0:g.includes(l.field))||!1}),o}else if(e!=null&&e.length)return z(e);return{}}),[s,i]=p.useState(()=>{var o;return(o=t==null?void 0:t.configuration)!=null&&o.column_order?t.configuration.column_order:e!=null&&e.length?J(e):[]}),a=p.useMemo(()=>({visibility:r,order:s}),[r,s]),f=p.useMemo(()=>({visible:Object.entries(r).filter(([l,g])=>g).map(([l])=>l),order:s}),[r,s]),u=p.useCallback(o=>{n(o)},[]),C=p.useCallback((o,l)=>{if(o!=null&&o.configuration){const g={};l.forEach(j=>{var v;g[j.field]=((v=o.configuration.visible_columns)==null?void 0:v.includes(j.field))||!1}),n(g),i(o.configuration.column_order||[])}else n(z(l)),i(J(l))},[]),m=p.useCallback(o=>{Object.keys(r).length===0&&n(z(o)),s.length===0&&i(J(o))},[]),S=p.useRef();return p.useEffect(()=>{var o,l,g;if(e!=null&&e.length){const j=((o=S.current)==null?void 0:o.id)!==(t==null?void 0:t.id),v=t&&((l=S.current)==null?void 0:l.id)===t.id&&S.current.updated_at!==t.updated_at;if(j||v)if(t!=null&&t.configuration){const h={};e.forEach(T=>{var O,w;h[T.field]=((w=(O=t.configuration)==null?void 0:O.visible_columns)==null?void 0:w.includes(T.field))||!1}),n(h),i(((g=t.configuration)==null?void 0:g.column_order)||[])}else n(z(e)),i(J(e))}S.current=t},[t,e]),{visibleColumns:r,columnOrder:s,columnState:a,currentColumns:f,setVisibleColumns:n,setColumnOrder:i,handleColumnVisibilityChange:u,handleViewChange:C,initializeColumns:m}}var K=500;function z(e){if(!e||e.length===0)return{};const t={};return e.forEach(r=>{t[r.field]=r.default_visible??!0}),t}function J(e){return!e||e.length===0?[]:[...e].sort((r,n)=>{const s=r.default_order??K,i=n.default_order??K;return s-i}).map(r=>r.field)}var Q={orders:{properties:["id","status","created_at","email","display_id","payment_status","fulfillment_status","total","currency_code"],relations:["*customer","*sales_channel"]},products:{properties:["id","title","handle","status","thumbnail"],relations:["collection.title","*sales_channels","*variants"]},customers:{properties:["id","email","first_name","last_name","created_at","updated_at","has_account"],relations:["*groups"]},inventory:{properties:["id","sku","title","description","stocked_quantity","reserved_quantity","created_at","updated_at"],relations:["*location_levels"]},default:{properties:["id","created_at","updated_at"],relations:[]}};function ke(e){const t=Q[e]||Q.default;return{properties:t.properties,relations:t.relations,formatted:[...t.properties,...t.relations].join(",")}}function Ie(e,t,r){const n=ke(e),s=n.formatted;if(!(t!=null&&t.length))return s;const i=t.filter(l=>Object.keys(r).length>0?r[l.field]===!0:l.default_visible),a=new Set;i.forEach(l=>{var g,j;l.computed?((g=l.computed.required_fields)==null||g.forEach(v=>a.add(v)),(j=l.computed.optional_fields)==null||j.forEach(v=>a.add(v))):(l.field.includes("."),a.add(l.field))});const f=Array.from(a),u=f.filter(l=>l.includes(".")),C=f.filter(l=>!l.includes(".")),m=u.filter(l=>{const[g]=l.split(".");return!n.relations.some(v=>v===`*${g}`||v===g)}),S=C.filter(l=>!n.properties.includes(l)),o=[...m,...S];return o.length>0?`${s},${o.join(",")}`:s}function Me(e){return e.startsWith("-")?{id:e.slice(1),desc:!0}:{id:e,desc:!1}}function Ve({entity:e,queryPrefix:t="",filters:r=[]}){const n=Ne("view_configurations"),[s,i]=Ee(),{activeView:a,createView:f}=be(e),u=(a==null?void 0:a.view_configuration)||null,{updateView:C}=Ce(e,(u==null?void 0:u.id)||""),{columns:m,isLoading:S}=Re(e,{enabled:n}),o=Se(["q","order","offset","limit",...r.map(_=>_.id)],t),{visibleColumns:l,columnOrder:g,currentColumns:j,setColumnOrder:v,handleColumnVisibilityChange:h,handleViewChange:T}=$e(m,u);p.useEffect(()=>{m&&(T(u,m),i(_=>{if(Array.from(_.keys()).filter(d=>d.startsWith(t+"_")||d===t+"_q"||d===t+"_order").forEach(d=>_.delete(d)),u){const d=u.configuration;if(d.filters&&Object.entries(d.filters).forEach(([A,x])=>{_.set(`${t}_${A}`,JSON.stringify(x))}),d.sorting){const A=d.sorting.desc?`-${d.sorting.id}`:d.sorting.id;_.set(`${t}_order`,A)}d.search&&_.set(`${t}_q`,d.search)}return _}))},[u,m]);const O=p.useMemo(()=>{const _={};return r.forEach(y=>{o[y.id]!==void 0&&(_[y.id]=JSON.parse(o[y.id]||""))}),{filters:_,sorting:o.order?Me(o.order):null,search:o.q||""}},[r,o]),[w,L]=p.useState(!1),M=p.useMemo(()=>{const _=O.filters,y=O.sorting,d=O.search,A=Object.entries(l).filter(([x,E])=>E).map(([x])=>x).sort();if(u){const x=u.configuration.filters||{},E=u.configuration.sorting,k=u.configuration.search||"",D=[...u.configuration.visible_columns||[]].sort(),R=u.configuration.column_order||[],q=new Set([...Object.keys(_),...Object.keys(x)]);for(const V of q)if(JSON.stringify(_[V])!==JSON.stringify(x[V]))return!0;const F=y||void 0,B=E||void 0;if(JSON.stringify(F)!==JSON.stringify(B)||d!==k||JSON.stringify(A)!==JSON.stringify(D)||JSON.stringify(g)!==JSON.stringify(R))return!0}else{if(Object.keys(_).length>0||y!==null||d!=="")return!0;if(m){const x=new Set(A),E=new Set(m.filter(D=>D.default_visible).map(D=>D.field));if(x.size!==E.size||[...x].some(D=>!E.has(D)))return!0;const k=m.sort((D,R)=>(D.default_order??500)-(R.default_order??500)).map(D=>D.field);if(JSON.stringify(g)!==JSON.stringify(k))return!0}}return!1},[u,l,g,O,m]);p.useEffect(()=>{const _=setTimeout(()=>{L(M)},50);return()=>clearTimeout(_)},[M]);const N=p.useCallback(()=>{m&&T(u,m),i(_=>{if(Array.from(_.keys()).filter(d=>d.startsWith(t+"_")||d===t+"_q"||d===t+"_order").forEach(d=>_.delete(d)),u!=null&&u.configuration){const d=u.configuration;if(d.filters&&Object.entries(d.filters).forEach(([A,x])=>{_.set(`${t}_${A}`,JSON.stringify(x))}),d.sorting){const A=d.sorting.desc?`-${d.sorting.id}`:d.sorting.id;_.set(`${t}_order`,A)}d.search&&_.set(`${t}_q`,d.search)}return _})},[u,m,t]),U=p.useMemo(()=>Ie(e,m,l),[e,m,l]);return{activeView:u,createView:f,updateView:C,isViewConfigEnabled:n,visibleColumns:l,columnOrder:g,currentColumns:j,setColumnOrder:v,handleColumnVisibilityChange:h,currentConfiguration:O,hasConfigurationChanged:w,handleClearConfiguration:N,apiColumns:m,isLoadingColumns:S,queryParams:o,requiredFields:U}}var b=new Map,ze=(e,t)=>t.split(".").reduce((r,n)=>r==null?void 0:r[n],e),P=(e,t,r,n)=>e==null?"-":String(e),Je=(e,t,r,n)=>{const s=e||[],i=Array.isArray(s)?s.length:0;return n("general.items",{count:i})},Z=(e,t,r,n)=>{if(!e)return"-";if(r.field==="status"&&t.status&&(t.handle||t.is_giftcard!==void 0))return c.jsx(fe,{status:t.status});const s=f=>{switch(f==null?void 0:f.toLowerCase()){case"active":case"published":case"fulfilled":case"paid":return"green";case"pending":case"proposed":case"processing":return"orange";case"draft":return"grey";case"rejected":case"failed":case"canceled":return"red";default:return"grey"}},a=((f,u)=>{if(!n)return f;const C=f.toLowerCase(),m=oe(C);switch(C){case"active":return n("general.active","Active");case"published":return n("products.productStatus.published","Published");case"draft":return n("orders.status.draft","Draft");case"pending":return n("orders.status.pending","Pending");case"canceled":return n("orders.status.canceled","Canceled");default:return u.context==="payment"?n(`orders.payment.status.${m}`,f):u.context==="fulfillment"?n(`orders.fulfillment.status.${m}`,f):n(`status.${C}`,f)}})(e,r);return c.jsx(ve,{color:s(e),children:a})},ee=(e,t,r,n)=>{if(r.field==="sales_channels_display"||r.field==="sales_channels")return c.jsx(ge,{salesChannels:t.sales_channels});if(!Array.isArray(e))return"-";const s=e.slice(0,2),i=e.length-2;return c.jsxs("div",{className:"flex gap-1",children:[s.map((a,f)=>c.jsx(G,{size:"xsmall",children:typeof a=="string"?a:a.name||a.title||"-"},f)),i>0&&c.jsx(G,{size:"xsmall",color:"grey",children:n?n("general.plusCountMore","+ {{count}} more",{count:i}):`+${i}`})]})},Le=(e,t,r,n)=>c.jsx(he,{product:t}),Ue=(e,t,r,n)=>c.jsx(me,{collection:t.collection}),qe=(e,t,r,n)=>c.jsx(_e,{variants:t.variants}),Be=(e,t,r,n)=>{var s,i,a,f;if((s=t.customer)!=null&&s.first_name||(i=t.customer)!=null&&i.last_name){const u=`${t.customer.first_name||""} ${t.customer.last_name||""}`.trim();if(u)return u}return(a=t.customer)!=null&&a.email?t.customer.email:(f=t.customer)!=null&&f.phone?t.customer.phone:n?n("customers.guest","Guest"):"Guest"},He=(e,t,r,n)=>{let s=null;if(r.field==="shipping_address_display"?s=t.shipping_address:r.field==="billing_address_display"?s=t.billing_address:s=t.shipping_address||t.billing_address,!s)return"-";const i=[];s.address_1&&i.push(s.address_1);const a=[];return s.city&&a.push(s.city),s.province&&a.push(s.province),s.postal_code&&a.push(s.postal_code),a.length>0&&i.push(a.join(", ")),s.country_code&&i.push(s.country_code.toUpperCase()),i.join(" • ")||"-"},Pe=(e,t,r,n)=>{var f;const s=(f=t.shipping_address)==null?void 0:f.country_code;if(!s)return c.jsx("div",{className:"flex w-full justify-center",children:"-"});const i=je(s),a=(i==null?void 0:i.display_name)||s.toUpperCase();return c.jsx("div",{className:"flex w-full items-center justify-center",children:c.jsx(xe,{content:a,children:c.jsx("div",{className:"flex size-4 items-center justify-center overflow-hidden rounded-sm",children:c.jsx(we,{countryCode:s.toUpperCase(),svg:!0,style:{width:"16px",height:"16px"},"aria-label":a})})})})},Y=(e,t,r,n)=>c.jsx(ce,{date:e}),We=(e,t,r,n)=>c.jsx(le,{displayId:e}),te=(e,t,r,n)=>{const s=t.currency_code||"USD";return c.jsx(de,{currencyCode:s,amount:e,align:"right"})},Ye=(e,t,r,n)=>{const s=t.currency_code||"USD";return c.jsx(ue,{currencyCode:s,total:e})};b.set("text",P);b.set("count",Je);b.set("status",Z);b.set("badge_list",ee);b.set("date",Y);b.set("timestamp",Y);b.set("currency",te);b.set("total",Ye);b.set("product_info",Le);b.set("collection",Ue);b.set("variants",qe);b.set("sales_channels_list",ee);b.set("customer_name",Be);b.set("address_summary",He);b.set("country_code",Pe);b.set("display_id",We);function Ge(e,t){if(e&&b.has(e))return b.get(e);switch(t){case"number":case"string":return P;case"date":return Y;case"boolean":return(r,n,s,i)=>i?r?i("fields.yes","Yes"):i("fields.no","No"):r?"Yes":"No";case"enum":return Z;case"currency":return te;default:return P}}function Ke(e,t){return t.computed?e:ze(e,t.field)}function Qe(e,t,r){const n=Te(),{t:s}=W();return p.useMemo(()=>t!=null&&t.length?t.map(i=>{var m;let a=(m=i.computed)==null?void 0:m.type;a||(i.semantic_type==="timestamp"?a="timestamp":i.field==="display_id"?a="display_id":i.field==="total"?a="total":i.semantic_type==="currency"&&(a="currency"));const f=Ge(a,i.data_type),u=r!=null&&r.getColumnAlignment?r.getColumnAlignment(i):Xe(i),C=S=>Ke(S,i);return n.accessor(C,{id:i.field,header:()=>i.name,cell:({getValue:S,row:o})=>{const l=S();if(r!=null&&r.transformCellValue){const g=r.transformCellValue(l,o.original,i);if(g!==null)return g}return f(l,o.original,i,s)},meta:{name:i.name,column:i},enableHiding:i.hideable,enableSorting:!1,headerAlign:u})}):[],[e,t,r,s])}function Xe(e){var t;return e.semantic_type==="currency"||e.data_type==="currency"||e.data_type==="number"&&e.context!=="identifier"||e.field.includes("total")||e.field.includes("amount")||e.field.includes("price")||e.field.includes("quantity")||e.field.includes("count")?"right":e.semantic_type==="status"||((t=e.computed)==null?void 0:t.type)==="country_code"||e.field==="country"||e.field.includes("country_code")?"center":"left"}var Ze={getColumnAlignment:e=>{var t;return e.semantic_type==="currency"?"right":e.semantic_type==="status"||((t=e.computed)==null?void 0:t.type)==="country_code"?"center":"left"}},et={getColumnAlignment:e=>{var t,r,n;return e.field==="product_display"||e.field==="collection.title"||e.field==="sales_channels_display"||e.field==="variants_count"?"left":e.field==="sku"?"center":e.field==="stock"||e.semantic_type==="currency"?"right":(e.semantic_type==="status"||((t=e.computed)==null?void 0:t.type)==="product_info"||((r=e.computed)==null?void 0:r.type)==="count"||((n=e.computed)==null?void 0:n.type)==="sales_channels_list","left")},transformCellValue:(e,t,r)=>{var n,s,i;if(r.field==="variants_count"||((n=r.computed)==null?void 0:n.type)==="count"){const a=Array.isArray(t.variants)?t.variants.length:0;return`${a} ${a===1?"variant":"variants"}`}return r.field==="product_display"||((s=r.computed)==null?void 0:s.type)==="product_info"||r.field==="sales_channels_display"||((i=r.computed)==null?void 0:i.type)==="sales_channels_list"||r.field==="status",null}},tt={getColumnAlignment:e=>e.field==="orders_count"||e.semantic_type==="currency"?"right":e.semantic_type==="status"?"center":"left",transformCellValue:(e,t,r)=>{if(r.field==="name"){const{first_name:n,last_name:s}=t;return n||s?`${n||""} ${s||""}`.trim():"-"}return null}},rt={getColumnAlignment:e=>e.field==="stocked_quantity"||e.field==="reserved_quantity"||e.field==="available_quantity"?"right":e.semantic_type==="status"?"center":"left"},nt={orders:Ze,products:et,customers:tt,inventory:rt};function st(e){return nt[e]}function _t({adapter:e,heading:t,subHeading:r,pageSize:n,queryPrefix:s,layout:i="fill",actions:a}){const{t:f}=W(),[u,C]=p.useState(!1),[m,S]=p.useState(null),o=e.entity,l=e.entityName,g=e.filters||[],j=n||e.pageSize||20,v=s||e.queryPrefix||"",{activeView:h,createView:T,updateView:O,isViewConfigEnabled:w,visibleColumns:L,columnOrder:M,currentColumns:N,setColumnOrder:U,handleColumnVisibilityChange:_,currentConfiguration:y,hasConfigurationChanged:d,handleClearConfiguration:A,isLoadingColumns:x,apiColumns:E,requiredFields:k,queryParams:D}=Ve({entity:o,pageSize:j,queryPrefix:v,filters:g}),R={...D};g.forEach(I=>{const H=I.id;if(R[H]!==void 0)try{R[H]=JSON.parse(R[H])}catch{}});const q={...R,fields:k,limit:j,offset:R.offset?Number(R.offset):0},F=e.useData(k,q),B=e.columnAdapter||st(o),V=Qe(o,E||[],B),re=e.getColumns&&E?e.getColumns(E):V;if(F.isError)throw F.error;const ne=async()=>{try{h!=null&&h.is_system_default?await O.mutateAsync({name:h.name||null,configuration:{visible_columns:N.visible,column_order:N.order,filters:y.filters||{},sorting:y.sorting||null,search:y.search||""}}):await T.mutateAsync({name:"Default",is_system_default:!0,set_active:!0,configuration:{visible_columns:N.visible,column_order:N.order,filters:y.filters||{},sorting:y.sorting||null,search:y.search||""}})}catch{}},se=async()=>{if(h)try{await O.mutateAsync({name:h.name,configuration:{visible_columns:N.visible,column_order:N.order,filters:y.filters||{},sorting:y.sorting||null,search:y.search||""}})}catch{}},ie=()=>{C(!0),S(null)},ae=d?c.jsxs(c.Fragment,{children:[c.jsx(X,{variant:"secondary",size:"small",type:"button",onClick:A,children:f("actions.clear")}),c.jsx(Fe,{isDefaultView:(h==null?void 0:h.is_system_default)||!h,currentViewId:h==null?void 0:h.id,currentViewName:h==null?void 0:h.name,onSaveAsDefault:ne,onUpdateExisting:se,onSaveAsNew:ie})]}):null;return c.jsxs(De,{className:"divide-y p-0",children:[c.jsx(ye,{data:F.data||[],columns:re,filters:g,getRowId:e.getRowId||(I=>I.id),rowCount:F.count,enablePagination:!0,enableSearch:!0,pageSize:j,isLoading:F.isLoading||x,layout:i,heading:t||l||(o?f(`${o}.domain`):""),subHeading:r,enableColumnVisibility:w,initialColumnVisibility:L,onColumnVisibilityChange:_,columnOrder:M,onColumnOrderChange:U,enableViewSelector:w,entity:o,currentColumns:N,filterBarContent:ae,rowHref:e.getRowHref,emptyState:e.emptyState||{empty:{heading:f(`${o}.list.noRecordsMessage`)}},prefix:v,actions:a,enableFilterMenu:!1}),u&&c.jsx(pe,{entity:o,currentColumns:N,currentConfiguration:y,editingView:m,onClose:()=>{C(!1),S(null)},onSaved:()=>{C(!1),S(null)}})]})}function ht(e){return{getRowId:t=>t.id,pageSize:20,queryPrefix:"",...e}}export{_t as C,ht as c,Ze as o,et as p};
