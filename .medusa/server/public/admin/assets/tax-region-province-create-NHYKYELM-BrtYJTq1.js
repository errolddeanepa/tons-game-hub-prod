import{a as S}from"./chunk-EHAU7SOS-CLzxgcUB.js";import{P}from"./chunk-KEQOAJC2-BgLxYgkT.js";import{S as E}from"./chunk-PRLQLEEQ-BTtB9WfB.js";import{K as L}from"./chunk-6HTZNHPT-CuoURaae.js";import{R as m,u as $}from"./chunk-AERWK3TJ-Bn16cSY6.js";import{r as R,b as F,j as e,au as h,aq as _,as as g,aE as M,at as B,ac as z,gj as H,ax as K,ay as V,gi as q,t as C,H as T,_ as N,X as a,Y as y,ag as X,c7 as Y,B as w}from"./index-8g9qLHfJ.js";var I=R.forwardRef(({disabled:r,placeholder:o,defaultValue:t,country_code:n,valueAs:i="iso_2",onChange:u,...d},c)=>{const{t:j}=F(),p=R.useRef(null);R.useImperativeHandle(c,()=>p.current);const s=S(n);s||(r=!0);const f=Object.entries((s==null?void 0:s.options)??{}).map(([l,b])=>e.jsx(h.Item,{value:i==="iso_2"?l.toLowerCase():b,children:b},l)),x=s?j(`taxRegions.fields.sublevels.placeholders.${s.type}`):"";return e.jsx("div",{className:"relative",children:e.jsxs(h,{...d,value:d.value?i==="iso_2"?d.value.toLowerCase():d.value:void 0,defaultValue:t?i==="iso_2"?t.toLowerCase():t:void 0,onValueChange:u,disabled:r,children:[e.jsx(h.Trigger,{ref:p,className:"w-full",children:e.jsx(h.Value,{placeholder:o||x})}),e.jsx(h.Content,{children:f})]})})});I.displayName="ProvinceSelect";var k=_({province_code:g().min(1),name:g().optional(),code:g().min(1),rate:_({float:M().optional(),value:g().optional()}).optional(),is_combinable:B().optional()}),D=({parent:r})=>{const{t:o}=F(),{handleSuccess:t}=$(),n=K({defaultValues:{province_code:"",code:"",is_combinable:!1,name:"",rate:{value:""}},resolver:V(k)}),{mutateAsync:i,isPending:u}=q(),d=n.handleSubmit(async s=>{var x;const f=s.name&&((x=s.rate)!=null&&x.float)?{name:s.name,rate:s.rate.float,code:s.code,is_combinable:s.is_combinable}:void 0;await i({country_code:r.country_code,province_code:s.province_code,parent_id:r.id,default_tax_rate:f},{onSuccess:({tax_region:l})=>{C.success(o("taxRegions.create.successToast")),t(`/settings/tax-regions/${r.id}/provinces/${l.id}`)},onError:l=>{C.error(l.message)}})}),c=S(r.country_code),j=(c==null?void 0:c.type)||"sublevel",p=o(`taxRegions.fields.sublevels.labels.${j}`);return e.jsx(m.Form,{form:n,children:e.jsxs(L,{onSubmit:d,className:"flex h-full flex-col overflow-hidden",children:[e.jsx(m.Header,{}),e.jsx(m.Body,{className:"flex flex-1 flex-col overflow-hidden",children:e.jsx("div",{className:"flex flex-1 flex-col items-center overflow-y-auto",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8 px-2 py-16",children:[e.jsxs("div",{children:[e.jsx(T,{children:o(`taxRegions.${j}.create.header`)}),e.jsx(N,{size:"small",className:"text-ui-fg-subtle",children:o(`taxRegions.${j}.create.hint`)})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:e.jsx(a.Field,{control:n.control,name:"province_code",render:({field:s})=>e.jsxs(a.Item,{children:[e.jsx(a.Label,{tooltip:!c&&o("taxRegions.fields.sublevels.tooltips.sublevel"),children:p}),e.jsx(a.Control,{children:c?e.jsx(I,{country_code:r.country_code,...s}):e.jsx(y,{...s,placeholder:"KR-26"})}),e.jsx(a.ErrorMessage,{})]})})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx(T,{level:"h2",className:"!txt-compact-small-plus",children:o("taxRegions.fields.defaultTaxRate.label")}),e.jsxs(N,{size:"small",leading:"compact",className:"text-ui-fg-muted",children:["(",o("fields.optional"),")"]}),e.jsx(X,{content:o("taxRegions.fields.defaultTaxRate.tooltip"),children:e.jsx(Y,{className:"text-ui-fg-muted"})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(a.Field,{control:n.control,name:"name",render:({field:s})=>e.jsxs(a.Item,{children:[e.jsx(a.Label,{children:o("fields.name")}),e.jsx(a.Control,{children:e.jsx(y,{...s})}),e.jsx(a.ErrorMessage,{})]})}),e.jsx(a.Field,{control:n.control,name:"rate",render:({field:{value:s,onChange:f,...x}})=>e.jsxs(a.Item,{children:[e.jsx(a.Label,{children:o("taxRegions.fields.taxRate")}),e.jsx(a.Control,{children:e.jsx(P,{...x,value:s==null?void 0:s.value,decimalsLimit:4,onValueChange:(l,b,v)=>f({value:l,float:v==null?void 0:v.float})})}),e.jsx(a.ErrorMessage,{})]})}),e.jsx(a.Field,{control:n.control,name:"code",render:({field:s})=>e.jsxs(a.Item,{children:[e.jsx(a.Label,{children:o("taxRegions.fields.taxCode")}),e.jsx(a.Control,{children:e.jsx(y,{...s})}),e.jsx(a.ErrorMessage,{})]})})]})]}),e.jsx(E,{control:n.control,name:"is_combinable",label:o("taxRegions.fields.isCombinable.label"),description:o("taxRegions.fields.isCombinable.hint")})]})})}),e.jsx(m.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(m.Close,{asChild:!0,children:e.jsx(w,{size:"small",variant:"secondary",children:o("actions.cancel")})}),e.jsx(w,{size:"small",type:"submit",isLoading:u,children:o("actions.save")})]})})]})})},Z=()=>{const{id:r}=z(),{tax_region:o,isPending:t,isError:n,error:i}=H(r),u=!t&&!!o;if(n)throw i;return e.jsx(m,{children:u&&e.jsx(D,{parent:o})})};export{Z as Component,Z as TaxProvinceCreate};
