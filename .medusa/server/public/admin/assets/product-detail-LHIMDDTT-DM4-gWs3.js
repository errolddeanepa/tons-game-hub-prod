import{S as X,a as Z}from"./chunk-HWKLNKOY-BSns10jQ.js";import{ab as U,j as e,q as ee,e as te,ac as se,a as B,ad as ae,p as ie,s as ne,b as g,C,H as _,A as N,P as y,g as M,u as H,h as re,ae as le,T as R,r as w,af as oe,I as Y,a4 as ce,ag as A,L as q,_ as k,B as de,ah as I,ai as ue,aj as F,n as me,ak as pe,al as xe,am as Q,an as he,ao as fe,t as ge,ap as ve,k as je,a6 as ye,o as be}from"./index-8g9qLHfJ.js";import{g as Se}from"./chunk-B6ZOPCPA-ZXWVCdGA.js";import{P as we}from"./chunk-AM2BU2RH-Jz_rw4zs.js";import{S as p}from"./chunk-LFLGEXIG-Bptb55rJ.js";import{T as E}from"./chunk-GIZFNLKK-DPDyiyc6.js";import{u as Ce}from"./chunk-2D44OO7A-CSl1quy_.js";import{u as Ne}from"./chunk-Q33G337Z-c-QkH0Cb.js";import{D as _e}from"./chunk-7GBCLBMX-C4oTIfDM.js";import{u as ke}from"./chunk-C76H5USB-CpZUC32H.js";import{P as L}from"./chunk-BDZE3G4Q-6Lia2mbI.js";import{T as Pe}from"./thumbnail-badge-CTzuFYz0.js";import{T as Te}from"./Trans-Apu7aNaL.js";import{C as W}from"./component-BTRRBoAm.js";import{c as De}from"./create-data-table-command-helper-C3wntDfO.js";import"./chunk-EQTBJSBZ-BsQCdeYX.js";import"./chunk-PFKKVLZX-CnhIpqla.js";var dt=s=>{const{id:t}=s.params||{},{product:a}=U(t,{fields:L},{initialData:s.data,enabled:!!t});return a?e.jsx("span",{children:a.title}):null},Ie=s=>({queryKey:ie.detail(s,{fields:L}),queryFn:async()=>ne.admin.product.retrieve(s,{fields:L})}),ut=async({params:s})=>{const t=s.id,a=Ie(t);return await ee.ensureQueryData({...a,staleTime:9e4})},ze=({product:s})=>{const{t}=g(),{getDisplays:a}=B();return e.jsxs(C,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(_,{level:"h2",children:t("products.attributes")}),e.jsx(N,{groups:[{actions:[{label:t("actions.edit"),to:"attributes",icon:e.jsx(y,{})}]}]})]}),e.jsx(p,{title:t("fields.height"),value:s.height}),e.jsx(p,{title:t("fields.width"),value:s.width}),e.jsx(p,{title:t("fields.length"),value:s.length}),e.jsx(p,{title:t("fields.weight"),value:s.weight}),e.jsx(p,{title:t("fields.midCode"),value:s.mid_code}),e.jsx(p,{title:t("fields.hsCode"),value:s.hs_code}),e.jsx(p,{title:t("fields.countryOfOrigin"),value:Se(s.origin_country)}),a("product","attributes").map((i,r)=>e.jsx(i,{data:s},r))]})},Ae=s=>{switch(s){case"draft":return"grey";case"proposed":return"orange";case"published":return"green";case"rejected":return"red";default:return"grey"}},Oe=({product:s})=>{const{t}=g(),a=M(),i=H(),{getDisplays:r}=B(),n=r("product","general"),{mutateAsync:u}=re(s.id),m=async()=>{await a({title:t("general.areYouSure"),description:t("products.deleteWarning",{title:s.title}),confirmText:t("actions.delete"),cancelText:t("actions.cancel")})&&await u(void 0,{onSuccess:()=>{i("..")},onError:l=>{ge.error(t("products.toasts.delete.error.header"),{description:l.message})}})};return e.jsxs(C,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(_,{children:s.title}),e.jsxs("div",{className:"flex items-center gap-x-4",children:[e.jsx(le,{color:Ae(s.status),children:t(`products.productStatus.${s.status}`)}),e.jsx(N,{groups:[{actions:[{label:t("actions.edit"),to:"edit",icon:e.jsx(y,{})}]},{actions:[{label:t("actions.delete"),onClick:m,icon:e.jsx(R,{})}]}]})]})]}),e.jsx(p,{title:t("fields.description"),value:s.description}),e.jsx(p,{title:t("fields.subtitle"),value:s.subtitle}),e.jsx(p,{title:t("fields.handle"),value:`/${s.handle}`}),e.jsx(p,{title:t("fields.discountable"),value:s.discountable?t("fields.true"):t("fields.false")}),n.map((f,l)=>e.jsx(f,{data:s},l))]})},$e=({product:s})=>{const{t}=g(),a=M(),[i,r]=w.useState({}),n=Le(s),u=l=>{r(x=>{if(x[l]){const{[l]:b,...c}=x;return c}else return{...x,[l]:!0}})},{mutateAsync:m}=oe(s.id),f=async()=>{const l=Object.keys(i),x=l.some(o=>{var d;return(d=n.find(h=>h.id===o))==null?void 0:d.isThumbnail});if(!await a({title:t("general.areYouSure"),description:x?t("products.media.deleteWarningWithThumbnail",{count:l.length}):t("products.media.deleteWarning",{count:l.length}),confirmText:t("actions.delete"),cancelText:t("actions.cancel")}))return;const c=s.images.filter(o=>!l.includes(o.id)).map(o=>({url:o.url}));await m({images:c,thumbnail:x?"":void 0},{onSuccess:()=>{r({})}})};return e.jsxs(C,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(_,{level:"h2",children:t("products.media.label")}),e.jsx(N,{groups:[{actions:[{label:t("actions.edit"),to:"media?view=edit",icon:e.jsx(y,{})}]}]})]}),n.length>0?e.jsx("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(96px,1fr))] gap-4 px-6 py-4",children:n.map((l,x)=>{const b=i[l.id];return e.jsxs("div",{className:"shadow-elevation-card-rest hover:shadow-elevation-card-hover transition-fg group relative aspect-square size-full cursor-pointer overflow-hidden rounded-[8px]",children:[e.jsx("div",{className:Y("transition-fg invisible absolute right-2 top-2 opacity-0 group-hover:visible group-hover:opacity-100",{"visible opacity-100":b}),children:e.jsx(ce,{checked:i[l.id]||!1,onCheckedChange:()=>u(l.id)})}),l.isThumbnail&&e.jsx("div",{className:"absolute left-2 top-2",children:e.jsx(A,{content:t("fields.thumbnail"),children:e.jsx(Pe,{})})}),e.jsx(q,{to:"media",state:{curr:x},children:e.jsx("img",{src:l.url,alt:`${s.title} image`,className:"size-full object-cover"})})]},l.id)})}):e.jsxs("div",{className:"flex flex-col items-center gap-y-4 pb-8 pt-6",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(k,{size:"small",leading:"compact",weight:"plus",className:"text-ui-fg-subtle",children:t("products.media.emptyState.header")}),e.jsx(k,{size:"small",className:"text-ui-fg-muted",children:t("products.media.emptyState.description")})]}),e.jsx(de,{size:"small",variant:"secondary",asChild:!0,children:e.jsx(q,{to:"media?view=edit",children:t("products.media.emptyState.action")})})]}),e.jsx(I,{open:!!Object.keys(i).length,children:e.jsxs(I.Bar,{children:[e.jsx(I.Value,{children:t("general.countSelected",{count:Object.keys(i).length})}),e.jsx(I.Seperator,{}),e.jsx(I.Command,{action:f,label:t("actions.delete"),shortcut:"d"})]})})]})},Le=s=>{const{images:t=[],thumbnail:a}=s,i=t.map(r=>({id:r.id,url:r.url,isThumbnail:r.url===a}));return a&&!i.some(r=>r.url===a)&&i.unshift({id:"img_thumbnail",url:a,isThumbnail:!0}),i},Be=({product:s,option:t})=>{const{t:a}=g(),{mutateAsync:i}=ve(s.id,t.id),r=M(),n=async()=>{await r({title:a("general.areYouSure"),description:a("products.options.deleteWarning",{title:t.title}),confirmText:a("actions.delete"),cancelText:a("actions.cancel")})&&await i()};return e.jsx(N,{groups:[{actions:[{label:a("actions.edit"),to:`options/${t.id}/edit`,icon:e.jsx(y,{})}]},{actions:[{label:a("actions.delete"),onClick:n,icon:e.jsx(R,{})}]}]})},Me=({product:s})=>{var a;const{t}=g();return e.jsxs(C,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(_,{level:"h2",children:t("products.options.header")}),e.jsx(N,{groups:[{actions:[{label:t("actions.create"),to:"options/create",icon:e.jsx(ue,{})}]}]})]}),(a=s.options)==null?void 0:a.map(i=>{var r;return e.jsx(p,{title:i.title,value:(r=i.values)==null?void 0:r.map(n=>e.jsx(F,{size:"2xsmall",className:"flex min-w-[20px] items-center justify-center",children:n.value},n.value)),actions:e.jsx(Be,{product:s,option:i})},i.id)})]})},Ee=({product:s})=>{var i,r;const{t}=g(),{getDisplays:a}=B();return e.jsxs(C,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(_,{level:"h2",children:t("products.organization.header")}),e.jsx(N,{groups:[{actions:[{label:t("actions.edit"),to:"organization",icon:e.jsx(y,{})}]}]})]}),e.jsx(p,{title:t("fields.tags"),value:(i=s.tags)!=null&&i.length?s.tags.map(n=>e.jsx($,{label:n.value,to:`/settings/product-tags/${n.id}`},n.id)):void 0}),e.jsx(p,{title:t("fields.type"),value:s.type?e.jsx($,{label:s.type.value,to:`/settings/product-types/${s.type_id}`}):void 0}),e.jsx(p,{title:t("fields.collection"),value:s.collection?e.jsx($,{label:s.collection.title,to:`/collections/${s.collection.id}`}):void 0}),e.jsx(p,{title:t("fields.categories"),value:(r=s.categories)!=null&&r.length?s.categories.map(n=>e.jsx($,{label:n.name,to:`/categories/${n.id}`},n.id)):void 0}),a("product","organize").map((n,u)=>e.jsx(n,{data:s},u))]})},$=({label:s,to:t})=>e.jsx(A,{content:s,children:e.jsx(F,{size:"2xsmall",className:"block w-fit truncate",asChild:!0,children:e.jsx(q,{to:t,children:s})})}),qe=({product:s})=>{var u;const{count:t}=me(),{t:a}=g(),i=((u=s.sales_channels)==null?void 0:u.map(m=>({id:m.id,name:m.name})))??[],r=i.slice(0,3),n=i.slice(3);return e.jsxs(C,{className:"flex flex-col gap-y-4 px-6 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(_,{level:"h2",children:a("fields.sales_channels")}),e.jsx(N,{groups:[{actions:[{label:a("actions.edit"),to:"sales-channels",icon:e.jsx(y,{})}]}]})]}),e.jsxs("div",{className:"grid grid-cols-[28px_1fr] items-center gap-x-3",children:[e.jsx("div",{className:"bg-ui-bg-base shadow-borders-base flex size-7 items-center justify-center rounded-md",children:e.jsx("div",{className:"bg-ui-bg-component flex size-6 items-center justify-center rounded-[4px]",children:e.jsx(pe,{className:"text-ui-fg-subtle"})})}),i.length>0?e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx(k,{size:"small",leading:"compact",children:r.map(m=>m.name).join(", ")}),n.length>0&&e.jsx(A,{content:e.jsx("ul",{children:n.map(m=>e.jsx("li",{children:m.name},m.id))}),children:e.jsx(k,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:`+${n.length}`})})]}):e.jsx(k,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:a("products.noSalesChannels")})]}),e.jsx("div",{children:e.jsx(k,{className:"text-ui-fg-subtle",size:"small",leading:"compact",children:e.jsx(Te,{i18nKey:"sales_channels.availableIn",values:{x:i.length,y:t??0},components:[e.jsx("span",{className:"text-ui-fg-base txt-compact-medium-plus"},"x"),e.jsx("span",{className:"text-ui-fg-base txt-compact-medium-plus"},"y")]})})})]})},V=10,K="pv",Ke=({product:s})=>{const{t}=g(),{q:a,order:i,offset:r,allow_backorder:n,manage_inventory:u,created_at:m,updated_at:f}=ke(["q","order","offset","manage_inventory","allow_backorder","created_at","updated_at"],K),l=He(s),x=Re(),b=We(),{variants:c,count:o,isPending:d,isError:h,error:v}=xe(s.id,{q:a,order:i||"variant_rank",offset:r?parseInt(r):void 0,limit:V,allow_backorder:n?JSON.parse(n):void 0,manage_inventory:u?JSON.parse(u):void 0,created_at:m?JSON.parse(m):void 0,updated_at:f?JSON.parse(f):void 0,fields:"title,sku,*options,created_at,updated_at,*inventory_items.inventory.location_levels,inventory_quantity,manage_inventory"},{placeholderData:je});if(h)throw v;return e.jsx(C,{className:"divide-y p-0",children:e.jsx(_e,{data:c,columns:l,filters:x,rowCount:o,getRowId:j=>j.id,rowHref:j=>`/products/${s.id}/variants/${j.id}`,pageSize:V,isLoading:d,heading:t("products.variants.header"),emptyState:{empty:{heading:t("products.variants.empty.heading"),description:t("products.variants.empty.description")},filtered:{heading:t("products.variants.filtered.heading"),description:t("products.variants.filtered.description")}},action:{label:t("actions.create"),to:"variants/create"},actionMenu:{groups:[{actions:[{label:t("products.editPrices"),to:"prices",icon:e.jsx(y,{})},{label:t("inventory.stock.action"),to:"stock",icon:e.jsx(Q,{})}]}]},commands:b,prefix:K})})},z=ye(),He=s=>{const{t}=g(),a=H(),{mutateAsync:i}=he(s.id),r=M(),[n]=fe(),u=w.useMemo(()=>{const c=new URLSearchParams;for(const[o,d]of n.entries())o.startsWith(`${K}_`)&&c.append(o,d);return c},[n]),m=Ce(),f=w.useCallback(async(c,o)=>{await r({title:t("general.areYouSure"),description:t("products.deleteVariantWarning",{title:o}),confirmText:t("actions.delete"),cancelText:t("actions.cancel")})&&await i({variantId:c})},[i,r,t]),l=w.useMemo(()=>s!=null&&s.options?s.options.map(c=>z.display({id:c.id,header:c.title,cell:({row:o})=>{var h;const d=(h=o.original.options)==null?void 0:h.find(v=>v.option_id===c.id);return d?e.jsx("div",{className:"flex items-center",children:e.jsx(A,{content:d.value,children:e.jsx(F,{size:"2xsmall",title:d.value,className:"inline-flex min-w-[20px] max-w-[140px] items-center justify-center overflow-hidden truncate",children:d.value})})}):e.jsx("span",{className:"text-ui-fg-muted",children:"-"})}})):[],[s]),x=w.useCallback(c=>{var j,P;const o=c.row.original,d=[{icon:e.jsx(y,{}),label:t("actions.edit"),onClick:S=>{a(`edit-variant?variant_id=${S.row.original.id}&${u.toString()}`,{state:{restore_params:u.toString()}})}}],h=[{icon:e.jsx(R,{}),label:t("actions.delete"),onClick:()=>f(o.id,o.title)}];switch(((j=o.inventory_items)==null?void 0:j.length)||0){case 0:break;case 1:{const S=`/inventory/${o.inventory_items[0].inventory.id}`;d.push({label:t("products.variant.inventory.actions.inventoryItems"),onClick:()=>{a(S)},icon:e.jsx(Q,{})});break}default:{const S=(P=o.inventory_items)==null?void 0:P.map(T=>{var D;return(D=T.inventory)==null?void 0:D.id});if(!S||S.length===0)break;const O=`/inventory?${new URLSearchParams({id:S.join(",")}).toString()}`;d.push({label:t("products.variant.inventory.actions.inventoryKit"),onClick:()=>{a(O)},icon:e.jsx(W,{})})}}return[d,h]},[f,a,t,u]),b=w.useCallback(c=>{var O;const o=c;if(!c.manage_inventory)return{text:t("products.variant.inventory.notManaged"),hasInventoryKit:!1,notManaged:!0};const d=c.inventory_quantity,h=(O=o.inventory_items)==null?void 0:O.map(T=>T.inventory).filter(Boolean),v=h.length>1,j={};h.forEach(T=>{var D;(D=T.location_levels)==null||D.forEach(G=>{j[G.id]=!0})});const P=Object.keys(j).length;return{text:v?t("products.variant.tableItemAvailable",{availableCount:d}):t("products.variant.tableItem",{availableCount:d,locationCount:P,count:P}),hasInventoryKit:v,quantity:d,notManaged:!1}},[t]);return w.useMemo(()=>[z.accessor("title",{header:t("fields.title"),enableSorting:!0,sortAscLabel:t("filters.sorting.alphabeticallyAsc"),sortDescLabel:t("filters.sorting.alphabeticallyDesc")}),z.accessor("sku",{header:t("fields.sku"),enableSorting:!0,sortAscLabel:t("filters.sorting.alphabeticallyAsc"),sortDescLabel:t("filters.sorting.alphabeticallyDesc")}),...l,z.display({id:"inventory",header:t("fields.inventory"),cell:({row:c})=>{const{text:o,hasInventoryKit:d,quantity:h,notManaged:v}=b(c.original);return e.jsx(A,{content:o,children:e.jsxs("div",{className:"flex h-full w-full items-center gap-2 overflow-hidden",children:[d&&e.jsx(W,{}),e.jsx("span",{className:Y("truncate",{"text-ui-fg-error":!h&&!v}),children:o})]})})},maxSize:250}),...m,z.action({actions:x})],[t,l,m,x,b])},J=be(),Re=()=>{const{t:s}=g(),t=Ne();return w.useMemo(()=>[J.accessor("allow_backorder",{type:"radio",label:s("fields.allowBackorder"),options:[{label:s("filters.radio.yes"),value:"true"},{label:s("filters.radio.no"),value:"false"}]}),J.accessor("manage_inventory",{type:"radio",label:s("fields.manageInventory"),options:[{label:s("filters.radio.yes"),value:"true"},{label:s("filters.radio.no"),value:"false"}]}),...t],[s,t])},Fe=De(),We=()=>{const{t:s}=g(),t=H();return[Fe.command({label:s("inventory.stock.action"),shortcut:"i",action:async a=>{t(`stock?${we}=${Object.keys(a).join(",")}`)}})]},Ve=({product:s})=>{const{t}=g(),a=s.shipping_profile;return e.jsxs(C,{className:"p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(_,{level:"h2",children:t("products.shippingProfile.header")}),e.jsx(N,{groups:[{actions:[{label:t("actions.edit"),to:"shipping-profile",icon:e.jsx(y,{})}]}]})]}),a&&e.jsx(X,{to:`/settings/locations/shipping-profiles/${a.id}`,labelKey:a.name,descriptionKey:a.type,icon:e.jsx(Z,{})})]})},mt=()=>{const s=te(),{id:t}=se(),{product:a,isLoading:i,isError:r,error:n}=U(t,{fields:L},{initialData:s}),{getWidgets:u}=B(),m=u("product.details.after"),f=u("product.details.before"),l=u("product.details.side.after"),x=u("product.details.side.before");if(i||!a)return e.jsx(ae,{mainSections:4,sidebarSections:3,showJSON:!0,showMetadata:!0});if(r)throw n;return e.jsxs(E,{widgets:{after:m,before:f,sideAfter:l,sideBefore:x},showJSON:!0,showMetadata:!0,data:a,children:[e.jsxs(E.Main,{children:[e.jsx(Oe,{product:a}),e.jsx($e,{product:a}),e.jsx(Me,{product:a}),e.jsx(Ke,{product:a})]}),e.jsxs(E.Sidebar,{children:[e.jsx(qe,{product:a}),e.jsx(Ve,{product:a}),e.jsx(Ee,{product:a}),e.jsx(ze,{product:a})]})]})};export{dt as Breadcrumb,mt as Component,ut as loader};
